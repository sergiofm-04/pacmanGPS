<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Board.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">PacmanGPS</a> &gt; <a href="index.source.html" class="el_package">default</a> &gt; <span class="el_source">Board.java</span></div><h1>Board.java</h1><pre class="source lang-java linenums">import javax.swing.*;
import java.awt.*;
import java.awt.event.*;

public class Board extends JPanel implements ActionListener {
    private static final int RESPAWN_DELAY_MS = 1000;
    private static final int STATUS_PANEL_HEIGHT = 40;
<span class="fc" id="L8">    private static final Color GHOST_HOUSE_FILL = new Color(100, 50, 150);</span>
<span class="fc" id="L9">    private static final Color GHOST_HOUSE_BORDER = new Color(150, 100, 200);</span>
    
    private Timer timer;
    private Pacman pacman;
    private Ghost[] ghosts;
<span class="fc" id="L14">    private int currentLevel = 0;</span>
<span class="fc" id="L15">    private int blockSize = 20;</span>
    private int[][][] levels;
    private boolean[][] points;
    private boolean[][] powerPellets;
    private int totalPoints;
<span class="fc" id="L20">    private int collectedPoints = 0;</span>
<span class="fc" id="L21">    private boolean gameWon = false;</span>
    private int[] ghostStartX;
    private int[] ghostStartY;
    private SoundManager soundManager;
    
    // 0 = empty space, 1 = wall, 2 = point, 3 = ghost house, 4 = power pellet
    private static final int EMPTY = 0;
    private static final int WALL = 1;
    private static final int POINT = 2;
    private static final int GHOST_HOUSE = 3;
    private static final int POWER_PELLET = 4;

<span class="fc" id="L33">    public Board() {</span>
<span class="fc" id="L34">        setFocusable(true);</span>
<span class="fc" id="L35">        setBackground(Color.BLACK);</span>
<span class="fc" id="L36">        soundManager = SoundManager.getInstance();</span>
<span class="fc" id="L37">        initLevels();</span>
<span class="fc" id="L38">        loadLevel(0);</span>
<span class="fc" id="L39">        timer = new Timer(40, this);</span>
<span class="fc" id="L40">        timer.start();</span>
<span class="fc" id="L41">        addKeyListener(new PacmanKeyAdapter());</span>
<span class="fc" id="L42">    }</span>
    
    private void initLevels() {
        // 3 niveles diferentes (20 filas x 20 columnas)
<span class="fc" id="L46">        levels = new int[3][20][20];</span>
        
        // Nivel 1 - Diseño simple
<span class="fc" id="L49">        int[][] level1 = {</span>
            {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
            {1,4,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,4,1},
            {1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,2,1,1,2,1},
            {1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,2,1,1,2,1},
            {1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1},
            {1,2,1,1,2,1,2,1,1,1,1,1,1,2,1,2,1,1,2,1},
            {1,2,2,2,2,1,2,2,2,1,1,2,2,2,1,2,2,2,2,1},
            {1,1,1,1,2,1,1,1,0,1,1,0,1,1,1,2,1,1,1,1},
            {1,1,1,1,2,1,0,0,0,0,0,0,0,0,1,2,1,1,1,1},
            {1,1,1,1,2,1,0,1,1,3,3,1,1,0,1,2,1,1,1,1},
            {0,0,0,0,2,0,0,1,3,3,3,3,1,0,0,2,0,0,0,0},
            {1,1,1,1,2,1,0,1,1,1,1,1,1,0,1,2,1,1,1,1},
            {1,1,1,1,2,1,0,0,0,0,0,0,0,0,1,2,1,1,1,1},
            {1,1,1,1,2,1,0,1,1,1,1,1,1,0,1,2,1,1,1,1},
            {1,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,1},
            {1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,2,1,1,2,1},
            {1,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,1},
            {1,1,2,1,2,1,2,1,1,1,1,1,1,2,1,2,1,2,1,1},
            {1,4,2,2,2,1,2,2,2,1,1,2,2,2,1,2,2,2,4,1},
            {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}
        };
        
        // Nivel 2 - Diseño intermedio
<span class="fc" id="L73">        int[][] level2 = {</span>
            {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
            {1,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,1},
            {1,2,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,2,1},
            {1,2,1,0,0,2,1,1,2,1,1,2,1,1,2,0,0,1,2,1},
            {1,2,1,1,1,2,2,2,2,2,2,2,2,2,2,1,1,1,2,1},
            {1,2,2,2,2,2,1,1,1,1,1,1,1,1,2,2,2,2,2,1},
            {1,2,1,1,1,2,2,2,2,1,1,2,2,2,2,1,1,1,2,1},
            {1,2,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,2,1},
            {1,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,1},
            {1,1,1,2,1,1,1,1,0,3,3,0,1,1,1,2,1,1,1,1},
            {1,1,1,2,1,0,0,0,3,3,3,3,0,0,1,2,1,1,1,1},
            {1,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,1},
            {1,2,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,2,1},
            {1,2,1,1,1,2,2,2,2,1,1,2,2,2,2,1,1,1,2,1},
            {1,2,2,2,2,2,1,1,1,1,1,1,1,1,2,2,2,2,2,1},
            {1,2,1,1,1,2,2,2,2,2,2,2,2,2,2,1,1,1,2,1},
            {1,2,1,0,0,2,1,1,2,1,1,2,1,1,2,0,0,1,2,1},
            {1,2,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,2,1},
            {1,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,1},
            {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}
        };
        
        // Nivel 3 - Diseño avanzado
<span class="fc" id="L97">        int[][] level3 = {</span>
            {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
            {1,4,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,4,1},
            {1,2,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,2,1},
            {1,2,1,0,0,0,0,1,2,1,1,2,1,0,0,0,0,1,2,1},
            {1,2,1,0,1,1,0,1,2,1,1,2,1,0,1,1,0,1,2,1},
            {1,2,1,0,1,1,0,1,2,2,2,2,1,0,1,1,0,1,2,1},
            {1,2,2,2,1,1,2,2,2,1,1,2,2,2,1,1,2,2,2,1},
            {1,1,1,2,1,1,2,1,1,1,1,1,1,2,1,1,2,1,1,1},
            {0,0,1,2,2,2,2,1,0,3,3,0,1,2,2,2,2,1,0,0},
            {1,1,1,2,1,1,2,1,0,3,3,0,1,2,1,1,2,1,1,1},
            {0,0,0,2,1,1,2,0,0,3,3,0,0,2,1,1,2,0,0,0},
            {1,1,1,2,1,1,2,1,1,1,1,1,1,2,1,1,2,1,1,1},
            {1,2,2,2,1,1,2,2,2,1,1,2,2,2,1,1,2,2,2,1},
            {1,2,1,0,1,1,0,1,2,2,2,2,1,0,1,1,0,1,2,1},
            {1,2,1,0,1,1,0,1,2,1,1,2,1,0,1,1,0,1,2,1},
            {1,2,1,0,0,0,0,1,2,1,1,2,1,0,0,0,0,1,2,1},
            {1,2,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,2,1},
            {1,2,2,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,1},
            {1,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1},
            {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}
        };
        
<span class="fc" id="L120">        levels[0] = level1;</span>
<span class="fc" id="L121">        levels[1] = level2;</span>
<span class="fc" id="L122">        levels[2] = level3;</span>
<span class="fc" id="L123">    }</span>
    
    private void loadLevel(int levelIndex) {
<span class="fc" id="L126">        currentLevel = levelIndex;</span>
<span class="fc" id="L127">        int[][] level = levels[levelIndex];</span>
<span class="fc" id="L128">        points = new boolean[20][20];</span>
<span class="fc" id="L129">        powerPellets = new boolean[20][20];</span>
<span class="fc" id="L130">        totalPoints = 0;</span>
<span class="fc" id="L131">        collectedPoints = 0;</span>
<span class="fc" id="L132">        gameWon = false;</span>
        
        // Inicializar puntos y power pellets basados en el nivel
<span class="fc bfc" id="L135" title="All 2 branches covered.">        for (int i = 0; i &lt; 20; i++) {</span>
<span class="fc bfc" id="L136" title="All 2 branches covered.">            for (int j = 0; j &lt; 20; j++) {</span>
<span class="fc bfc" id="L137" title="All 2 branches covered.">                if (level[i][j] == POINT) {</span>
<span class="fc" id="L138">                    points[i][j] = true;</span>
<span class="fc" id="L139">                    totalPoints++;</span>
                } else {
<span class="fc" id="L141">                    points[i][j] = false;</span>
                }
                
<span class="fc bfc" id="L144" title="All 2 branches covered.">                if (level[i][j] == POWER_PELLET) {</span>
<span class="fc" id="L145">                    powerPellets[i][j] = true;</span>
<span class="fc" id="L146">                    totalPoints++;</span>
                } else {
<span class="fc" id="L148">                    powerPellets[i][j] = false;</span>
                }
            }
        }
        
        // Posicionar Pacman en un lugar seguro del nivel
<span class="fc" id="L154">        pacman = new Pacman(blockSize * 1, blockSize * 1, this);</span>
        
        // Posicionar fantasmas
<span class="fc" id="L157">        ghostStartX = new int[] {blockSize * 9, blockSize * 10, blockSize * 9};</span>
<span class="fc" id="L158">        ghostStartY = new int[] {blockSize * 9, blockSize * 9, blockSize * 10};</span>
<span class="fc" id="L159">        ghosts = new Ghost[] {</span>
            new Ghost(ghostStartX[0], ghostStartY[0], Color.RED, this),
            new Ghost(ghostStartX[1], ghostStartY[1], Color.PINK, this),
            new Ghost(ghostStartX[2], ghostStartY[2], Color.CYAN, this)
        };
<span class="fc" id="L164">    }</span>

    @Override
    public void paintComponent(Graphics g) {
<span class="nc" id="L168">        super.paintComponent(g);</span>
<span class="nc" id="L169">        drawStatusPanel(g);</span>
<span class="nc" id="L170">        drawBoard(g);</span>
<span class="nc" id="L171">        pacman.draw(g, STATUS_PANEL_HEIGHT);</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">        for (Ghost ghost : ghosts) {</span>
<span class="nc" id="L173">            ghost.draw(g, STATUS_PANEL_HEIGHT);</span>
        }
        
<span class="nc bnc" id="L176" title="All 2 branches missed.">        if (gameWon) {</span>
<span class="nc" id="L177">            g.setColor(Color.GREEN);</span>
<span class="nc" id="L178">            g.setFont(new Font(&quot;Arial&quot;, Font.BOLD, 30));</span>
<span class="nc" id="L179">            g.drawString(&quot;¡NIVEL COMPLETADO!&quot;, 50, 200 + STATUS_PANEL_HEIGHT);</span>
        }
<span class="nc" id="L181">    }</span>
    
    private void drawStatusPanel(Graphics g) {
        // Draw status panel background
<span class="nc" id="L185">        g.setColor(new Color(20, 20, 20));</span>
<span class="nc" id="L186">        g.fillRect(0, 0, getBoardWidth(), STATUS_PANEL_HEIGHT);</span>
        
        // Draw border
<span class="nc" id="L189">        g.setColor(Color.CYAN);</span>
<span class="nc" id="L190">        g.drawRect(0, 0, getBoardWidth() - 1, STATUS_PANEL_HEIGHT - 1);</span>
        
        // Draw lives
<span class="nc" id="L193">        g.setColor(Color.YELLOW);</span>
<span class="nc" id="L194">        g.setFont(new Font(&quot;Arial&quot;, Font.BOLD, 14));</span>
<span class="nc" id="L195">        g.drawString(&quot;Vidas: &quot; + pacman.getLives(), 10, 25);</span>
        
        // Draw score
<span class="nc" id="L198">        g.drawString(&quot;Puntos: &quot; + pacman.getScore(), 120, 25);</span>
        
        // Draw level info
<span class="nc" id="L201">        g.drawString(&quot;Nivel: &quot; + (currentLevel + 1), 250, 25);</span>
        
        // Draw power-up timer if active
<span class="nc bnc" id="L204" title="All 2 branches missed.">        if (pacman.isPoweredUp()) {</span>
<span class="nc" id="L205">            long remaining = pacman.getRemainingPowerUpTime();</span>
<span class="nc" id="L206">            g.setColor(Color.GREEN);</span>
<span class="nc" id="L207">            g.drawString(&quot;Power: &quot; + (remaining / 1000) + &quot;s&quot;, 320, 25);</span>
        }
<span class="nc" id="L209">    }</span>

    private void drawBoard(Graphics g) {
<span class="nc" id="L212">        int[][] level = levels[currentLevel];</span>
        
        // Dibujar paredes y puntos (offset by STATUS_PANEL_HEIGHT)
<span class="nc bnc" id="L215" title="All 2 branches missed.">        for (int i = 0; i &lt; 20; i++) {</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">            for (int j = 0; j &lt; 20; j++) {</span>
<span class="nc" id="L217">                int x = j * blockSize;</span>
<span class="nc" id="L218">                int y = i * blockSize + STATUS_PANEL_HEIGHT;</span>
                
<span class="nc bnc" id="L220" title="All 2 branches missed.">                if (level[i][j] == WALL) {</span>
                    // Dibujar pared
<span class="nc" id="L222">                    g.setColor(Color.BLUE);</span>
<span class="nc" id="L223">                    g.fillRect(x, y, blockSize, blockSize);</span>
<span class="nc" id="L224">                    g.setColor(Color.CYAN);</span>
<span class="nc" id="L225">                    g.drawRect(x, y, blockSize, blockSize);</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">                } else if (level[i][j] == GHOST_HOUSE) {</span>
                    // Draw ghost house with special walls
<span class="nc" id="L228">                    g.setColor(GHOST_HOUSE_FILL);</span>
<span class="nc" id="L229">                    g.fillRect(x, y, blockSize, blockSize);</span>
<span class="nc" id="L230">                    g.setColor(GHOST_HOUSE_BORDER);</span>
<span class="nc" id="L231">                    g.drawRect(x, y, blockSize, blockSize);</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">                } else if (points[i][j]) {</span>
                    // Dibujar punto
<span class="nc" id="L234">                    g.setColor(Color.WHITE);</span>
<span class="nc" id="L235">                    g.fillOval(x + blockSize/2 - 2, y + blockSize/2 - 2, 4, 4);</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">                } else if (powerPellets[i][j]) {</span>
                    // Dibujar power pellet (más grande y brillante)
<span class="nc" id="L238">                    g.setColor(Color.WHITE);</span>
<span class="nc" id="L239">                    g.fillOval(x + blockSize/2 - 5, y + blockSize/2 - 5, 10, 10);</span>
                }
            }
        }
<span class="nc" id="L243">    }</span>

    @Override
    public void actionPerformed(ActionEvent e) {
<span class="fc bfc" id="L247" title="All 2 branches covered.">        if (!gameWon) {</span>
<span class="fc" id="L248">            pacman.move();</span>
<span class="fc bfc" id="L249" title="All 2 branches covered.">            for (Ghost ghost : ghosts) {</span>
<span class="fc" id="L250">                ghost.move();</span>
            }
            
            // Update ghost frightened state based on power-up
<span class="fc bfc" id="L254" title="All 2 branches covered.">            if (!pacman.isPoweredUp()) {</span>
<span class="fc bfc" id="L255" title="All 2 branches covered.">                for (Ghost ghost : ghosts) {</span>
<span class="fc" id="L256">                    ghost.setFrightened(false);</span>
                }
            }
            
<span class="fc" id="L260">            checkCollisions();</span>
        }
<span class="fc" id="L262">        repaint();</span>
<span class="fc" id="L263">    }</span>
    
    private void checkLevelCompletion() {
<span class="fc bfc" id="L266" title="All 2 branches covered.">        if (collectedPoints &gt;= totalPoints) {</span>
<span class="fc" id="L267">            gameWon = true;</span>
<span class="fc" id="L268">            timer.stop();</span>
<span class="fc" id="L269">            soundManager.playSound(&quot;level_complete&quot;);</span>
            
            // Después de 2 segundos, cargar siguiente nivel
<span class="fc" id="L272">            Timer nextLevelTimer = new Timer(2000, new ActionListener() {</span>
                @Override
                public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L275" title="All 2 branches missed.">                    if (currentLevel &lt; 2) {</span>
<span class="nc" id="L276">                        loadLevel(currentLevel + 1);</span>
<span class="nc" id="L277">                        timer.start();</span>
                    } else {
                        // Juego completado
<span class="nc" id="L280">                        JOptionPane.showMessageDialog(Board.this, </span>
<span class="nc" id="L281">                            &quot;¡Felicidades! Has completado todos los niveles.\nPuntuación final: &quot; + pacman.getScore());</span>
                    }
<span class="nc" id="L283">                    ((Timer)e.getSource()).stop();</span>
<span class="nc" id="L284">                }</span>
            });
<span class="fc" id="L286">            nextLevelTimer.setRepeats(false);</span>
<span class="fc" id="L287">            nextLevelTimer.start();</span>
        }
<span class="fc" id="L289">    }</span>
    
    private void checkCollisions() {
        // Verificar colisión con puntos
<span class="fc" id="L293">        int pacRow = pacman.getY() / blockSize;</span>
<span class="fc" id="L294">        int pacCol = pacman.getX() / blockSize;</span>
        
<span class="pc bpc" id="L296" title="4 of 8 branches missed.">        if (pacRow &gt;= 0 &amp;&amp; pacRow &lt; 20 &amp;&amp; pacCol &gt;= 0 &amp;&amp; pacCol &lt; 20) {</span>
<span class="pc bpc" id="L297" title="1 of 2 branches missed.">            if (points[pacRow][pacCol]) {</span>
<span class="nc" id="L298">                points[pacRow][pacCol] = false;</span>
<span class="nc" id="L299">                pacman.addScore(10);</span>
<span class="nc" id="L300">                collectedPoints++;</span>
<span class="nc" id="L301">                soundManager.playSound(&quot;eat_dot&quot;);</span>
<span class="nc" id="L302">                checkLevelCompletion();</span>
            }
            
            // Verificar colisión con power pellets
<span class="fc bfc" id="L306" title="All 2 branches covered.">            if (powerPellets[pacRow][pacCol]) {</span>
<span class="fc" id="L307">                powerPellets[pacRow][pacCol] = false;</span>
<span class="fc" id="L308">                pacman.addScore(50);</span>
<span class="fc" id="L309">                collectedPoints++;</span>
<span class="fc" id="L310">                soundManager.playSound(&quot;eat_power&quot;);</span>
                
                // Activar power-up
<span class="fc" id="L313">                pacman.activatePowerUp();</span>
<span class="fc bfc" id="L314" title="All 2 branches covered.">                for (Ghost ghost : ghosts) {</span>
<span class="fc" id="L315">                    ghost.setFrightened(true);</span>
                }
                
<span class="fc" id="L318">                checkLevelCompletion();</span>
            }
        }
        
        // Verificar colisión con fantasmas
<span class="fc" id="L323">        int characterSize = Pacman.getCharacterSize();</span>
<span class="fc bfc" id="L324" title="All 2 branches covered.">        for (Ghost ghost : ghosts) {</span>
<span class="pc bpc" id="L325" title="1 of 2 branches missed.">            if (Math.abs(pacman.getX() - ghost.getX()) &lt; characterSize &amp;&amp; </span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">                Math.abs(pacman.getY() - ghost.getY()) &lt; characterSize) {</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">                if (ghost.isFrightened()) {</span>
                    // Pacman come al fantasma cuando está asustado
<span class="nc" id="L329">                    pacman.addScore(200);</span>
<span class="nc" id="L330">                    ghost.sendToStart();</span>
<span class="nc" id="L331">                    soundManager.playSound(&quot;eat_ghost&quot;);</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">                } else if (!ghost.isReturning()) {</span>
                    // Fantasma atrapa a Pacman (solo si no está regresando al inicio)
<span class="nc" id="L334">                    handlePacmanCaught();</span>
<span class="nc" id="L335">                    break;</span>
                }
            }
        }
<span class="fc" id="L339">    }</span>
    
    private void handlePacmanCaught() {
<span class="fc" id="L342">        pacman.loseLife();</span>
<span class="fc" id="L343">        soundManager.playSound(&quot;death&quot;);</span>
        
<span class="pc bpc" id="L345" title="1 of 2 branches missed.">        if (pacman.getLives() &lt;= 0) {</span>
            // Game Over
<span class="nc" id="L347">            timer.stop();</span>
<span class="nc" id="L348">            JOptionPane.showMessageDialog(this, </span>
<span class="nc" id="L349">                &quot;¡Game Over! Un fantasma te atrapó.\nPuntuación: &quot; + pacman.getScore());</span>
<span class="nc" id="L350">            System.exit(0);</span>
        } else {
            // Resetear posiciones pero mantener el progreso
<span class="fc" id="L353">            timer.stop();</span>
<span class="fc" id="L354">            pacman.resetPosition();</span>
<span class="fc bfc" id="L355" title="All 2 branches covered.">            for (int i = 0; i &lt; ghosts.length; i++) {</span>
<span class="fc" id="L356">                ghosts[i].resetPosition(ghostStartX[i], ghostStartY[i]);</span>
                // Reset ghost states when respawning
<span class="fc" id="L358">                ghosts[i].setFrightened(false);</span>
            }
            
            // Pausar brevemente antes de continuar
<span class="fc" id="L362">            Timer respawnTimer = new Timer(RESPAWN_DELAY_MS, new ActionListener() {</span>
                @Override
                public void actionPerformed(ActionEvent e) {
<span class="nc" id="L365">                    timer.start();</span>
<span class="nc" id="L366">                    ((Timer)e.getSource()).stop();</span>
<span class="nc" id="L367">                }</span>
            });
<span class="fc" id="L369">            respawnTimer.setRepeats(false);</span>
<span class="fc" id="L370">            respawnTimer.start();</span>
        }
<span class="fc" id="L372">    }</span>
    
    public boolean isWall(int x, int y) {
<span class="fc" id="L375">        int row = y / blockSize;</span>
<span class="fc" id="L376">        int col = x / blockSize;</span>
        
        // Verificar límites verticales
<span class="fc bfc" id="L379" title="All 4 branches covered.">        if (row &lt; 0 || row &gt;= 20) {</span>
<span class="fc" id="L380">            return true;</span>
        }
        
        // Si está fuera de los límites horizontales, verificar si es un túnel
<span class="fc bfc" id="L384" title="All 4 branches covered.">        if (col &lt; 0 || col &gt;= 20) {</span>
            // Permitir movimiento fuera de límites en las filas de túnel
            // Verificar si la fila actual tiene apertura en los bordes
<span class="fc" id="L387">            int[][] level = levels[currentLevel];</span>
<span class="fc bfc" id="L388" title="All 2 branches covered.">            if (col &lt; 0) {</span>
                // Verificando lado izquierdo - columna 0
<span class="pc bpc" id="L390" title="1 of 2 branches missed.">                return level[row][0] == WALL;</span>
            } else {
                // Verificando lado derecho - columna 19
<span class="pc bpc" id="L393" title="1 of 2 branches missed.">                return level[row][19] == WALL;</span>
            }
        }
        
<span class="fc bfc" id="L397" title="All 2 branches covered.">        return levels[currentLevel][row][col] == WALL;</span>
    }
    
    public boolean isWallForPacman(int x, int y) {
<span class="fc" id="L401">        int row = y / blockSize;</span>
<span class="fc" id="L402">        int col = x / blockSize;</span>
        
        // Verificar límites verticales
<span class="fc bfc" id="L405" title="All 4 branches covered.">        if (row &lt; 0 || row &gt;= 20) {</span>
<span class="fc" id="L406">            return true;</span>
        }
        
        // Si está fuera de los límites horizontales, verificar si es un túnel
<span class="pc bpc" id="L410" title="2 of 4 branches missed.">        if (col &lt; 0 || col &gt;= 20) {</span>
            // Permitir movimiento fuera de límites en las filas de túnel
            // Verificar si la fila actual tiene apertura en los bordes
<span class="nc" id="L413">            int[][] level = levels[currentLevel];</span>
<span class="nc bnc" id="L414" title="All 2 branches missed.">            if (col &lt; 0) {</span>
                // Verificando lado izquierdo - columna 0
<span class="nc bnc" id="L416" title="All 2 branches missed.">                return level[row][0] == WALL;</span>
            } else {
                // Verificando lado derecho - columna 19
<span class="nc bnc" id="L419" title="All 2 branches missed.">                return level[row][19] == WALL;</span>
            }
        }
        
<span class="fc" id="L423">        int cellValue = levels[currentLevel][row][col];</span>
        // Pacman cannot enter walls or ghost house
<span class="fc bfc" id="L425" title="All 4 branches covered.">        return cellValue == WALL || cellValue == GHOST_HOUSE;</span>
    }
    
    public int getBlockSize() {
<span class="fc" id="L429">        return blockSize;</span>
    }
    
    public int getBoardWidth() {
<span class="fc" id="L433">        return 20 * blockSize;</span>
    }
    
    public int getBoardHeight() {
<span class="fc" id="L437">        return 20 * blockSize;</span>
    }

<span class="fc" id="L440">    private class PacmanKeyAdapter extends KeyAdapter {</span>
        @Override
        public void keyPressed(KeyEvent e) {
<span class="nc" id="L443">            pacman.keyPressed(e);</span>
<span class="nc" id="L444">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>